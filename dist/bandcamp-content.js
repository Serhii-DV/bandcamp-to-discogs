(()=>{"use strict";function t(t){return"function"==typeof t}function e(t){return t.replace(/[\u200B-\u200D\uFEFF\u200E\u200F\u202A-\u202E]|&lrm;/g,"")}const r="album",n="artists",i="community",s="merch",o="music",a="track",c="video",l="unknown";class u{constructor(t){this.value=t}isAlbum=()=>this.value===r;isArtists=()=>this.value===n;isCommunity=()=>this.value===i;isMerch=()=>this.value===s;isMusic=()=>this.value===o;isTrack=()=>this.value===a;isVideo=()=>this.value===c;isUnknow=()=>this.value===l}class d{constructor(){this.url=window.location.href}detect=()=>{const t=this;let e=l;return t.isAlbum()?e=r:t.isArtists()?e=n:t.isCommunity()?e=i:t.isMusic()?e=o:t.isMerch()?e=s:t.isTrack()?e=a:t.isVideo()&&(e=c),new u(e)};isAlbum=()=>this.url.includes("/album/");isArtists=()=>this.url.includes("/artists/")||!!document.querySelector(".artists-grid");isCommunity=()=>this.url.includes("/community/");isMerch=()=>this.url.includes("/merch/");isMusic=()=>this.url.includes("/music/")||!!document.querySelector("#music-grid");isTrack=()=>this.url.includes("/track/");isVideo=()=>this.url.includes("/video/")}const h="This draft was created via CSV upload and Bandcamp To Discogs Google Chrome extension {extension_url}\n\nRelease url: {release_url}",m=[];for(let t=0;t<256;++t)m.push((t+256).toString(16).slice(1));const f=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,p=function(t){if(!function(t){return"string"==typeof t&&f.test(t)}(t))throw TypeError("Invalid UUID");let e;const r=new Uint8Array(16);return r[0]=(e=parseInt(t.slice(0,8),16))>>>24,r[1]=e>>>16&255,r[2]=e>>>8&255,r[3]=255&e,r[4]=(e=parseInt(t.slice(9,13),16))>>>8,r[5]=255&e,r[6]=(e=parseInt(t.slice(14,18),16))>>>8,r[7]=255&e,r[8]=(e=parseInt(t.slice(19,23),16))>>>8,r[9]=255&e,r[10]=(e=parseInt(t.slice(24,36),16))/1099511627776&255,r[11]=e/4294967296&255,r[12]=e>>>24&255,r[13]=e>>>16&255,r[14]=e>>>8&255,r[15]=255&e,r};function g(t,e,r,n){switch(t){case 0:return e&r^~e&n;case 1:case 3:return e^r^n;case 2:return e&r^e&n^r&n}}function b(t,e){return t<<e|t>>>32-e}const w=function(t,e,r){function n(t,e,r,n){var i;if("string"==typeof t&&(t=function(t){t=unescape(encodeURIComponent(t));const e=[];for(let r=0;r<t.length;++r)e.push(t.charCodeAt(r));return e}(t)),"string"==typeof e&&(e=p(e)),16!==(null===(i=e)||void 0===i?void 0:i.length))throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let s=new Uint8Array(16+t.length);if(s.set(e),s.set(t,e.length),s=function(t){const e=[1518500249,1859775393,2400959708,3395469782],r=[1732584193,4023233417,2562383102,271733878,3285377520];if("string"==typeof t){const e=unescape(encodeURIComponent(t));t=[];for(let r=0;r<e.length;++r)t.push(e.charCodeAt(r))}else Array.isArray(t)||(t=Array.prototype.slice.call(t));t.push(128);const n=t.length/4+2,i=Math.ceil(n/16),s=new Array(i);for(let e=0;e<i;++e){const r=new Uint32Array(16);for(let n=0;n<16;++n)r[n]=t[64*e+4*n]<<24|t[64*e+4*n+1]<<16|t[64*e+4*n+2]<<8|t[64*e+4*n+3];s[e]=r}s[i-1][14]=8*(t.length-1)/Math.pow(2,32),s[i-1][14]=Math.floor(s[i-1][14]),s[i-1][15]=8*(t.length-1)&4294967295;for(let t=0;t<i;++t){const n=new Uint32Array(80);for(let e=0;e<16;++e)n[e]=s[t][e];for(let t=16;t<80;++t)n[t]=b(n[t-3]^n[t-8]^n[t-14]^n[t-16],1);let i=r[0],o=r[1],a=r[2],c=r[3],l=r[4];for(let t=0;t<80;++t){const r=Math.floor(t/20),s=b(i,5)+g(r,o,a,c)+l+e[r]+n[t]>>>0;l=c,c=a,a=b(o,30)>>>0,o=i,i=s}r[0]=r[0]+i>>>0,r[1]=r[1]+o>>>0,r[2]=r[2]+a>>>0,r[3]=r[3]+c>>>0,r[4]=r[4]+l>>>0}return[r[0]>>24&255,r[0]>>16&255,r[0]>>8&255,255&r[0],r[1]>>24&255,r[1]>>16&255,r[1]>>8&255,255&r[1],r[2]>>24&255,r[2]>>16&255,r[2]>>8&255,255&r[2],r[3]>>24&255,r[3]>>16&255,r[3]>>8&255,255&r[3],r[4]>>24&255,r[4]>>16&255,r[4]>>8&255,255&r[4]]}(s),s[6]=15&s[6]|80,s[8]=63&s[8]|128,r){n=n||0;for(let t=0;t<16;++t)r[n+t]=s[t];return r}return function(t,e=0){return m[t[e+0]]+m[t[e+1]]+m[t[e+2]]+m[t[e+3]]+"-"+m[t[e+4]]+m[t[e+5]]+"-"+m[t[e+6]]+m[t[e+7]]+"-"+m[t[e+8]]+m[t[e+9]]+"-"+m[t[e+10]]+m[t[e+11]]+m[t[e+12]]+m[t[e+13]]+m[t[e+14]]+m[t[e+15]]}(s)}try{n.name="v5"}catch(t){}return n.DNS="6ba7b810-9dad-11d1-80b4-00c04fd430c8",n.URL="6ba7b811-9dad-11d1-80b4-00c04fd430c8",n}();function y(t){return w(t,w.URL)}class v{constructor(t,e,r){this.url=t,this.artist=e,this.title=r,this.uuid=y(t)}static fromObject(t){return new v(t.url,t.artist,t.title)}}class S{releaseItem;label;published;modified;tracks;tracksQty;image;keywords;constructor(t,e,r,n,i,s,o,a,c){this.releaseItem=new v(o,t,e),this.label=r,this.published=n,this.modified=i,this.tracks=s,this.tracksQty=s.length,this.image=a,this.keywords=c}get artist(){return this.releaseItem.artist}get url(){return this.releaseItem.url}get title(){return this.releaseItem.title}toStorageObject(){return{uuid:this.releaseItem.uuid,artist:this.releaseItem.artist,title:this.releaseItem.title,url:this.releaseItem.url,label:this.label,published:this.published.toISOString(),modified:this.modified.toISOString(),tracks:this.tracks,image:this.image,keywords:this.keywords}}static fromStorageObject(t){if(!t.url||!t.tracks)throw new Error("Cannot create Release object from object",t);const e=t.tracks.map((t=>new A(t.num,t.title,t.duration)));if(!t.published&&!t.date)throw new Error("Missing published or date property");if(!t.modified&&!t.date)throw new Error("Missing published or date property");return new S(t.artist,t.title,t.label,new Date(t.published??t.date),new Date(t.modified??t.date),e,t.url,t.image,t.keywords)}toMetadata(){return{version:chrome.runtime.getManifest().version,format:{qty:this.tracksQty,fileType:"FLAC",description:"Album"},submissionNotes:(this,function(t,e){for(const r in e)e.hasOwnProperty(r)&&(t=t.replace(`{${r}}`,e[r]));return t}(h,{extension_url:"https://chrome.google.com/webstore/detail/bandcamp-to-discogs-b2d/hipnkehalkffbdjnbbeoefmoondaciok",release_url:this.releaseItem.url}))}}}class A{num;title;duration;constructor(t,e,r){this.num=t,this.title=e,this.duration=r}}class I{date;value;constructor(t,e,r){this.date=new Date(0),this.date.setHours(t),this.date.setMinutes(e),this.date.setSeconds(r),this.value=this.toString()}toString(){return new Intl.DateTimeFormat("en",{hour12:!1,hour:"2-digit",minute:"2-digit",second:"2-digit"}).format(this.date)}static fromDuration(t){const e=(/(\d+)H/.exec(t)||[])[1]||0,r=(/(\d+)M/.exec(t)||[])[1]||0,n=(/(\d+)S/.exec(t)||[])[1]||0;return new I(parseInt(e,10),parseInt(r,10),parseInt(n,10))}}function k(t,e,r=void 0){return function(t,e){return t.hasAttribute(`data-${e}`)}(t,e)?t.getAttribute(`data-${e}`):r}function M(t,e){return function(t){return"string"==typeof t}(e)?(t.value!==e&&(t.value=e,E(t)),t):(E(t),t)}function E(t){return t.dispatchEvent(new Event("input")),t}function C(t){const e=document.createElement("div");return e.innerHTML=t.trim(),e.firstChild}function D(){const t=[];return document.querySelectorAll("#music-grid .music-grid-item").forEach((r=>{const n=function(t){let r=t.querySelector(".artist-override")?.innerText;r||(r=document.querySelector("#band-name-location .title").innerText),r=function(t,e){const r=" -\n".replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&"),n=new RegExp(`^[${r}]+|[${r}]+$`,"g");return t.replace(n,"")}(r),r=e(r);const n=e(t.querySelector(".title").innerText.split("\n")[0]),i=t.querySelector("a").getAttribute("href");return{artist:r,title:n,url:("/"===i[0]?window.location.origin:"")+i,item_id:k(t,"item-id")}}(r);t.push(n)})),t}const q=chrome.storage.local;function R(){const e=function(t){const e=t.byArtist.name,r=t.name,n=t.publisher.name,i=new Date(t.datePublished),s=new Date(t.dateModified),o=t.track.itemListElement.map((t=>new A(t.position,t.item.name,I.fromDuration(t.item.duration)))),a=t.mainEntityOfPage,c=t.image,l=t.keywords;return new S(e,r,n,i,s,o,a,c,l)}(function(){const t=document.querySelector('script[type="application/ld+json"]');return t?JSON.parse(t.textContent):null}());!function(e){!function(e,r,n){const i=y(e);q.get([i],(e=>{if(s=e[i],"[object Object]"===Object.prototype.toString.call(s))try{const n=S.fromStorageObject(e[i]);t(r)&&r(n)}catch(t){console.log("B2D: Broken storage data for release",e[i])}else console.log("B2D: Release data doesn't exists",i),t(n)&&n(i);var s}))}(window.location.href,null,(t=>{!function(t){const e=function(t){return y(t.releaseItem.url)}(t);q.set({[e]:t.toStorageObject()},(()=>{console.log("B2D: Release data was saved in the local storage")}))}(e)}))}(e),function(t){chrome.runtime.onMessage.addListener(((e,r,n)=>("getBandcampData"===e.type&&n({type:"release",data:t.toStorageObject()}),!0)))}(e)}function B(){window.B2D=window.B2D||{},window.B2D.pageReleases=D(),chrome.runtime.onMessage.addListener(((t,e,r)=>("getBandcampData"===t.type&&r({type:"list",data:window.B2D.pageReleases,popup:{imageSrc:document.querySelector(".band-photo").src,search:document.querySelector("#b2dArtistFilter").value}}),!0))),function(){let t=document.querySelector("#music-grid"),e=new Isotope(t,{itemSelector:".music-grid-item",layoutMode:"fitRows"});const r=function(){const t=window.B2D||{};return function(t){return Array.isArray(t)}(e=t.pageReleases)&&0!==e.length||(t.pageReleases=D()),t.pageReleases;var e}();r.forEach((e=>{!function(t,e,r=""){t.setAttribute(`data-${e}`,r)}(t.querySelector('[data-item-id="'+e.item_id+'"]'),"filter-artist",(e.artist+" - "+e.title).toLowerCase())}));const n=function(t){let e=C('<div class="b2d-widget">\n  <label for="b2dArtistFilter">Artist / Album:</label>\n  <input list="artist-filter-data" id="b2dArtistFilter" name="artist-filter" />\n</div>');const r=function(t){let e=[],r=[],n=[];return t.forEach((t=>{if(function(t,e){for(const e of["V/A"])if(t.includes(e))return!0;return!1}(t.artist))r.push(t.artist);else{const n=(e=/[,/+â€¢|]| Vs | & +/,t.artist.split(e).map((t=>t.trim())).filter((t=>""!==t)));r.push(...n)}var e})),r.sort(),e.push(...function(t){const e=new Map,r=new Map,n=[];for(const n of t){const t=n.toLowerCase();r.has(t)||r.set(t,n),e.set(t,(e.get(t)||0)+1)}for(const[t,i]of r){const r=e.get(t);r>1?n.push(`${i} (${r})`):n.push(i)}return n}(r)),t.forEach((t=>n.push(t.artist+" - "+t.title))),n.sort(),e.push(...n),[...new Set(e)]}(t),n=function(t,e){const r=document.createElement("datalist");return r.id="artist-filter-data",t.forEach((t=>{const e=document.createElement("option");e.value=t,r.appendChild(e)})),r}(r);return e.append(n),e}(r),i=C('<div class="b2d-widget-container"></div>'),s=function(t){return C(`<div class="b2d-albumAmount b2d-widget" title="The amount of releases on the page">\nReleases: <span class="b2d-visible">${t.length}</span> / <span class="b2d-total">${t.length}</span>\n</div>`)}(r);i.append(n),i.append(s),document.querySelector(".leftMiddleColumns").prepend(i),function(t,e,r){const n=t.querySelector("#b2dArtistFilter");n.addEventListener("input",(()=>{let t=n.value.replace(/\s*\([^)]*\)/,"");n.value=t,t=t.toLowerCase();const i=t?`[data-filter-artist*="${t}"]`:"*";e.arrange({filter:i}),r.querySelector(".b2d-visible").innerHTML=e.getFilteredItemElements().length,window.scrollBy(0,1),window.scrollBy(0,-1)})),chrome.runtime.onMessage.addListener(((t,e,r)=>{"releases-list-search"===t.type&&M(n,t.search)}));const i=document.querySelector(".leftMiddleColumns .label-band-selector-container");if(i){let t=function(t,e,r){const n=t.querySelectorAll(".bands-menu-title span");for(const t of n)if(t.textContent.includes("artists"))return t;return null}(i);t||(t=i.querySelector(".bands-menu-title span.name")),t&&function(t,e,r=1e3){let n=t.textContent;setInterval((()=>{const r=t.textContent;r!==n&&(e(r),n=r)}),r)}(t,(t=>{"artists"===t&&(t=""),M(n,t)}),500)}}(n,e,s),console.log("B2D: Isotope setuped correctly")}()}!function(){const t=(new d).detect();t.isMusic()?B():t.isAlbum()&&R(),function(t){const e=document.createElement("link");e.rel="stylesheet",e.href=t,document.head.appendChild(e)}(chrome.runtime.getURL("src/bandcamp/styles.css"))}()})();
//# sourceMappingURL=bandcamp-content.js.map